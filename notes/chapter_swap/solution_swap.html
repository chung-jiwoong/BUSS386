<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Ji-Woong Chung">

<title>Introduction to Swaps: Solutions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="solution_swap_files/libs/clipboard/clipboard.min.js"></script>
<script src="solution_swap_files/libs/quarto-html/quarto.js"></script>
<script src="solution_swap_files/libs/quarto-html/popper.min.js"></script>
<script src="solution_swap_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="solution_swap_files/libs/quarto-html/anchor.min.js"></script>
<link href="solution_swap_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="solution_swap_files/libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="solution_swap_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="solution_swap_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="solution_swap_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Swaps: Solutions</h1>
<p class="subtitle lead">BUSS386 Futures and Options</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Ji-Woong Chung </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="day-counting" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="day-counting"><span class="header-section-number">1</span> Day counting</h2>
<p>There are 32 calendar days between July 7, 2014 and August 8, 2014. There are 184 calendar days between July 7, 2014 and January 7, 2015. The interest earned per $100 of principal is therefore 3.5×32/184=$0.6087. For a corporate bond we assume 31 days between July 7 and August 8, 2014 and 180 days between July 7, 2014 and January 7, 2015. The interest earned is 3.5×31/180 = $0.6028.</p>
</section>
<section id="cash-pricequoted-price" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="cash-pricequoted-price"><span class="header-section-number">2</span> Cash price/Quoted price</h2>
<p>There are 89 days between October 12, 2014, and January 9, 2015. There are 182 days between October 12, 2014, and April 12, 2014. The cash price of the bond is obtained by adding the accrued interest to the quoted price. The quoted price is 102 7/32 or 102.21875. The cash price is therefore</p>
<p>102.21875+(89/182)×6=$105.15</p>
</section>
<section id="cheapest-to-deliver" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="cheapest-to-deliver"><span class="header-section-number">3</span> Cheapest to deliver</h2>
<p>The cheapest-to-deliver bond is the one for which</p>
<p>Quoted Price – Futures Price × Conversion Factor</p>
<p>is least. Calculating this factor for each of the 4 bonds we get</p>
<p>Bond 1:125.15625-101.375×1.2131=2.178</p>
<p>Bond 2:142.46875-101.375×1.3792 = 2.652</p>
<p>Bond 3:115.96875-101.375×1.1149= 2.946</p>
<p>Bond 4:144.06250-101.375×1.4026=1.874</p>
<p>Bond 4 is therefore the cheapest to deliver.</p>
</section>
<section id="bond-futures-price" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="bond-futures-price"><span class="header-section-number">4</span> Bond futures price</h2>
<p>There are 176 days between February 4 and July 30 and 181 days between February 4 and August 4. The cash price of the bond is, therefore:</p>
<p>110+(176/181)×6.5=116.32</p>
<p>The rate of interest with continuous compounding is 2ln1.06=0.1165 or 11.65% per annum. A coupon of 6.5 will be received in 5 days or 0.1370 years. The present value of the coupon is</p>
<p>5e^(-0.1370×0.1165) = 6.490</p>
<p>The futures contract lasts for 62 days or 0.1699 years. The cash futures price if the contract were written on the 13% bond would be</p>
<p>(116.32-6.490)e^(0.1699×0.1165) = 112.03</p>
<p>At delivery there are 57 days of accrued interest. The quoted futures price if the contract were written on the 13% bond would therefore be</p>
<p>112.03-6.5×(57/184) = 110.01</p>
<p>Taking the conversion factor into account the quoted futures price should be:</p>
<p>110.01/1.5 = 73.34</p>
</section>
<section id="bond-futures-price-1" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="bond-futures-price-1"><span class="header-section-number">5</span> Bond futures price</h2>
<p>The cash bond price is currently</p>
<p>137 + (9/184)×4=137.1957</p>
<p>A coupon of 4 will be received after 175 days or 0.4795 years. The present value of the coupon on the bond is 4e-0.05×0.4795=3.9053. The futures contract lasts 296 days or 0.8110 years. The cash futures price if it were written on the 8% bond would therefore be</p>
<p>(137.1957 - 3.9053)e^(0.05×0.8110)=138.8061</p>
<p>At delivery there are 121 days of accrued interest. The quoted futures if the contract were written on the 8% bond would therefore be</p>
<p>138.8061-4×(121/182) =136.1468</p>
<p>The quoted price should therefore be</p>
<p>136.1468/1.2191 = 111.68</p>
</section>
<section id="eurodollar-futures" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="eurodollar-futures"><span class="header-section-number">6</span> Eurodollar futures</h2>
<p>The Eurodollar futures price has increased by 6 basis points. The investor makes a gain per contract of 25×6=$150 or $300 in total.</p>
</section>
<section id="eurodollar-futures-1" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="eurodollar-futures-1"><span class="header-section-number">7</span> Eurodollar futures</h2>
<p>The forward interest rate for the time period between months 6 and 9 is 9% per annum with continuous compounding. This is because 9% per annum for three months when combined with 7.5% per annum for six months gives an average interest rate of 8% per annum for the nine-month period.</p>
<p>With quarterly compounding the forward interest rate is</p>
<p>4(e^(0.09/4) -1) = 0.09102</p>
<p>or 9.102%. The three-month Eurodollar quote for a contract maturing in six months is therefore 100-9.102 = 90.898. Note we ignore the issues with day counting.</p>
</section>
<section id="duration-and-convexity" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="duration-and-convexity"><span class="header-section-number">8</span> Duration and Convexity</h2>
<ol type="a">
<li><span class="math inline">\(D\_{Mac}=1\)</span> year. Therefore, <span class="math inline">\(D_m=D\_{Mac}/(1+y/k)=1/(1+0.03)=0.9708\$\)</span>.</li>
</ol>
<p>The Macaulay convexity is t(t+1)K_t/(1+y), and the modified duration is</p>
<p><span class="math inline">\(C\_{Mac}/(1+y)^2=1.8852\)</span></p>
<ol start="2" type="a">
<li><p><span class="math inline">\(D_m=4.5042\)</span> and <span class="math inline">\(C_m=25.568\)</span>.</p></li>
<li><p><span class="math inline">\(dP/P=dDdy + (1/2)C(dy)^2\)</span></p></li>
</ol>
<p>For bond (a), <span class="math inline">\(dP_a/P_a=-D_a*dy + (1/2)C_a*(dy)^2\)</span></p>
<p>For bond (b), <span class="math inline">\(dP_b/P_b=-D_b*dy + (1/2)C_b*(dy)^2\)</span></p>
<p>Finally,</p>
<p><span class="math inline">\(dP= dP_a/P_a*P_a + dP_b/P_b*P_b=\$6,115.67\)</span></p>
<ol start="4" type="a">
<li>For floating rate payor, the swap is a long position in fixed rate bond and a short position in floating rate bond. Using duration, <span class="math inline">\(-dP/dy = +D_{fixed}P_{fixed}-D_{float}P_{float}\)</span>, where <span class="math inline">\(D_{fixed}P_{fixed}=\$8.4223\)</span> and <span class="math inline">\(\$D_{float}P_{float}=\$0.9685\)</span>.</li>
</ol>
<p>Therefore, <span class="math inline">\(-dP/dy=\$7.4538\)</span>.</p>
</section>
<section id="hedging-interest-rate-risk" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="hedging-interest-rate-risk"><span class="header-section-number">9</span> Hedging Interest Rate Risk</h2>
<p>The treasurer should short Treasury bond futures contract. If bond prices go down, this futures position will provide offsetting gains. The number of contracts that should be shorted is</p>
<p>(10,000,000×7.1)/(91,375×8.8) = 88.30</p>
<p>Rounding to the nearest whole number 88 contracts should be shorted.</p>
<p>This answer is designed to reduce the duration to zero. To reduce the duration from 7.1 to 3.0 instead of from 7.1 to 0, the treasurer should short</p>
<p>(4.1/7.1)x88.30=50.99</p>
<p>or 51 contracts.</p>
</section>
<section id="hedging-interest-rate-risk-1" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="hedging-interest-rate-risk-1"><span class="header-section-number">10</span> Hedging Interest Rate Risk</h2>
<p>The value of a contract is 108 × 1,000=$108,468.75. The number of contracts that should be shorted is</p>
<p>(6,000,000/108,468.75) × (8.2/7.6) = 59.7</p>
<p>Rounding to the nearest whole number, 60 contracts should be shorted. The position should be closed out at the end of July.</p>
</section>
<section id="hedging-interest-rate-risk-2" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="hedging-interest-rate-risk-2"><span class="header-section-number">11</span> Hedging Interest Rate Risk</h2>
<ol type="a">
<li><p>You have positive duration 2.9. From 1(d), floating rate payor has a positive duration. Therefore, you should be fixed rate payor to eliminate your positive duration of the existing position.</p></li>
<li><p><span class="math inline">\(D_{fund}P_{fund}+D_{swap}P_{swap}=0\)</span>. Therefore, <span class="math inline">\(2.8(\$2,500) + (-7.4538)P_{swap} =0\)</span></p></li>
<li><p><span class="math inline">\(dP = -DPdy. dP_{swap}=18.125\)</span> and <span class="math inline">\(dP_{fund}=18.12\)</span></p></li>
<li><p><span class="math inline">\(dP_{swap} = -dP_{fix}+dP_{float} =\$17.8710\)</span></p></li>
</ol>
<p><span class="math inline">\(-dP_{fix} =-[-D_{fix}dy + (1/2)*C_{fix}(dy)^2]*P\)</span></p>
<p><span class="math inline">\(+dP_{float} =+[-D_{float}dy + (1/2)*C_{float}(dy)^2]*P\)</span></p>
<ol start="5" type="a">
<li><p>True. <span class="math inline">\(C_{swap} =-C_{fixed}+C_{float}&lt;0\)</span></p></li>
<li><p>All.</p></li>
</ol>
</section>
<section id="interest-rate-swap" class="level2" data-number="12">
<h2 data-number="12" class="anchored" data-anchor-id="interest-rate-swap"><span class="header-section-number">12</span> Interest Rate Swap</h2>
<p>A has an apparent comparative advantage in fixed-rate markets but wants to borrow floating. B has an apparent comparative advantage in floating-rate markets but wants to borrow fixed. This provides the basis for the swap. There is a 1.4% per annum differential between the fixed rates offered to the two companies and a 0.5% per annum differential between the floating rates offered to the two companies. The total gain to all parties from the swap is therefore 1.4-0.5=0.9% per annum. Because the bank gets 0.1% per annum of this gain, the swap should make each of A and B 0.4% per annum better off. This means that it should lead to A borrowing at LIBOR -0.3% and to B borrowing at 6.0%.</p>
</section>
<section id="currency-swap" class="level2" data-number="13">
<h2 data-number="13" class="anchored" data-anchor-id="currency-swap"><span class="header-section-number">13</span> Currency Swap</h2>
<p>X has a comparative advantage in yen markets but wants to borrow dollars. Y has a comparative advantage in dollar markets but wants to borrow yen. This provides the basis for the swap. There is a 1.5% per annum differential between the yen rates and a 0.4% per annum differential between the dollar rates. The total gain to all parties from the swap is therefore 1.5-0.4=1.1% per annum. The bank requires 0.5% per annum, leaving 0.3% per annum for each of X and Y. The swap should lead to X borrowing dollars at 9.6-0.3=9.3% per annum and to Y borrowing yen at 6.5-0.3=6.2% per annum. All foreign exchange risk is borne by the bank.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>