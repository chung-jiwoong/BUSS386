<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Ji-Woong Chung">

<title>Practice Problem Set: Problems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="problem_pricing_forwards_files/libs/clipboard/clipboard.min.js"></script>
<script src="problem_pricing_forwards_files/libs/quarto-html/quarto.js"></script>
<script src="problem_pricing_forwards_files/libs/quarto-html/popper.min.js"></script>
<script src="problem_pricing_forwards_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="problem_pricing_forwards_files/libs/quarto-html/anchor.min.js"></script>
<link href="problem_pricing_forwards_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="problem_pricing_forwards_files/libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="problem_pricing_forwards_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="problem_pricing_forwards_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="problem_pricing_forwards_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practice Problem Set: Problems</h1>
<p class="subtitle lead">BUSS386 Futures and Options</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Ji-Woong Chung </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<ul>
<li>If you notice any typos or errors, please feel free to <a href="chung_jiwoong@gmail.com">email me</a>.</li>
<li>Many of the problems are sourced from Hull (2022).</li>
</ul>
<hr>
<section id="computational-exercises" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Computational Exercises</h1>
<hr>
<section id="margin-account" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="margin-account"><span class="header-section-number">1.1</span> Margin Account</h2>
<p>A trader buys two July futures contracts on frozen orange juice. Each contract is for the delivery of 15,000 pounds. The current futures price is 160 cents per pound, the initial margin is $6,000 per contract, and the maintenance margin is $4,500 per contract. What price change would lead to a margin call? Under what circumstances could $2,000 be withdrawn from the margin account?</p>
<!-- ...solution removed... -->
</section>
<section id="trading-futures" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="trading-futures"><span class="header-section-number">1.2</span> Trading Futures</h2>
<p>Suppose that on October 24, 2015, a company sells one April 2016 live-cattle futures contract. It closes out its position on January 21, 2016. The futures price is 121.20 cents when it enters into the contract, 118.30 cents when it closes out its position, and 118.80 cents at the end of December 2015. One contract is for the delivery of 40,000 pounds of cattle. What is the total profit?</p>
<!-- ...solution removed... -->
</section>
<section id="forwards-vs.-futures" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="forwards-vs.-futures"><span class="header-section-number">1.3</span> Forwards vs.&nbsp;Futures</h2>
<p>Trader A enters into futures contracts to buy 1 million euros for 1.3 million dollars in three months. Trader B enters in a forward contract to do the same thing. The exchange rate (dollars per euro) declines sharply during the first two months and then increases for the third month to close at 1.3300. Ignoring daily settlement, what is the total profit of each trader? When the impact of daily settlement is taken into account, which trader does better?</p>
<!-- ...solution removed... -->
</section>
<section id="arbitrage-with-futures" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="arbitrage-with-futures"><span class="header-section-number">1.4</span> Arbitrage with Futures</h2>
<p>Suppose there are no storage costs for crude oil and the interest rate for borrowing or lending is 5% per annum. How could you make money if the June and December futures contracts for a particular year trade at $80 and $86?</p>
<!-- ...solution removed... -->
</section>
<section id="minimum-variance-hedge-ratio" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="minimum-variance-hedge-ratio"><span class="header-section-number">1.5</span> Minimum-Variance Hedge Ratio</h2>
<p>Under what circumstances does a minimum-variance hedge portfolio lead to no hedging at all?</p>
<!-- ...solution removed... -->
</section>
<section id="minimum-variance-hedge-ratio-example-2" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="minimum-variance-hedge-ratio-example-2"><span class="header-section-number">1.6</span> Minimum-Variance Hedge Ratio (Example 2)</h2>
<p>Suppose that the standard deviation of quarterly changes in the prices of a commodity is $0.65, the standard deviation of quarterly changes in a futures price on the commodity is $0.81, and the coefficient of correlation between the two changes is 0.8. What is the optimal hedge ratio for a three-month contract? What does it mean?</p>
<!-- ...solution removed... -->
</section>
<section id="minimum-variance-hedge-ratio-example-3" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="minimum-variance-hedge-ratio-example-3"><span class="header-section-number">1.7</span> Minimum-Variance Hedge Ratio (Example 3)</h2>
<p>A company has a $20 million portfolio with a beta of 1.2. It would like to use futures contracts on a stock index to hedge its risk. The index futures is currently standing at 1080, and each contract is for delivery of $250 times the index. What is the hedge that minimizes risk? What should the company do if it wants to reduce the beta of the portfolio to 0.6?</p>
<!-- ...solution removed... -->
</section>
<section id="hedging-with-futures" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="hedging-with-futures"><span class="header-section-number">1.8</span> Hedging with Futures</h2>
<p>The standard deviation of monthly changes in the spot price of live cattle is 1.2 (in cents per pound), and the standard deviation of monthly changes in the futures price of live cattle for the closest contract is 1.4. The correlation between the futures price changes and the spot price changes is 0.7. It is now October 15. A beef producer is committed to purchasing 200,000 pounds of live cattle on November 15. The producer wants to use the December live-cattle futures contracts to hedge its risk. Each contract is for the delivery of 40,000 pounds of cattle. What strategy should the beef producer follow?</p>
<!-- ...solution removed... -->
</section>
<section id="futures" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="futures"><span class="header-section-number">1.9</span> Futures</h2>
<p>A futures contract is used for hedging. Explain why the daily settlement of the contract can give rise to cash flow problems.</p>
<!-- ...solution removed... -->
</section>
<section id="minimum-variance-hedge-ratio-with-data" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="minimum-variance-hedge-ratio-with-data"><span class="header-section-number">1.10</span> Minimum-Variance Hedge Ratio with Data</h2>
<p>The table below gives data on monthly changes in the spot price and the futures price for a certain commodity. Use the data to calculate a minimum variance hedge ratio.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Month</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Spot Price Change</td>
<td>+0.50</td>
<td>+0.61</td>
<td>-0.22</td>
<td>-0.35</td>
<td>+0.79</td>
</tr>
<tr class="even">
<td>Futures Price Change</td>
<td>+0.56</td>
<td>+0.63</td>
<td>-0.12</td>
<td>-0.44</td>
<td>+0.60</td>
</tr>
<tr class="odd">
<td>Month</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
</tr>
<tr class="even">
<td>Spot Price Change</td>
<td>+0.04</td>
<td>+0.15</td>
<td>+0.70</td>
<td>-0.51</td>
<td>-0.41</td>
</tr>
<tr class="odd">
<td>Futures Price Change</td>
<td>-0.06</td>
<td>+0.01</td>
<td>+0.80</td>
<td>-0.56</td>
<td>-0.46</td>
</tr>
</tbody>
</table>
<p>What is the minimum variance hedge ratio?</p>
<!-- ...solution removed... -->
</section>
<section id="forward-price" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="forward-price"><span class="header-section-number">1.11</span> Forward Price</h2>
<p>What is the difference between the forward price and the value of a forward contract?</p>
<!-- ...solution removed... -->
</section>
<section id="forward-price-example-2" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="forward-price-example-2"><span class="header-section-number">1.12</span> Forward Price (Example 2)</h2>
<p>A stock index currently stands at 350. The risk-free interest rate is 8% per annum (continuous compounding) and the dividend yield is 4% per annum. What should the futures price be for a four-month contract?</p>
<!-- ...solution removed... -->
</section>
<section id="forward-pricing" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="forward-pricing"><span class="header-section-number">1.13</span> Forward Pricing</h2>
<p>A one-year long forward contract on a non-dividend-paying stock is entered into when the stock price is $40 and the risk-free rate is 10% per annum (continuous compounding).</p>
<ol type="a">
<li><p>What are the forward price and the initial value of the forward contract?</p></li>
<li><p>Six months later, the stock price is $45 and the risk-free rate remains 10%. What are the forward price and the value of the forward contract?</p></li>
</ol>
<!-- ...solution removed... -->
</section>
<section id="forward-pricing-example-2" class="level2" data-number="1.14">
<h2 data-number="1.14" class="anchored" data-anchor-id="forward-pricing-example-2"><span class="header-section-number">1.14</span> Forward Pricing (Example 2)</h2>
<p>Suppose that the risk-free rate is 10% per annum (continuous compounding) and the dividend yield on a stock index is 4% per annum. The index is at 400, and the futures price for a contract deliverable in four months is 405. What arbitrage opportunities exist?</p>
<!-- ...solution removed... -->
</section>
<section id="arbitrage" class="level2" data-number="1.15">
<h2 data-number="1.15" class="anchored" data-anchor-id="arbitrage"><span class="header-section-number">1.15</span> Arbitrage</h2>
<p>In early 2012, the spot exchange rate between the Swiss Franc and U.S. dollar was 1.0404 ($ per franc). The U.S. and Swiss interest rates were 0.25% and 0% per annum (continuously compounded), respectively. The three‐month forward exchange rate was 1.0300 ($ per franc). What arbitrage strategy was possible? How does your answer change if the exchange rate is 1.0500 ($ per franc)?</p>
<!-- ...solution removed... -->
</section>
<section id="forward-pricing-example-3" class="level2" data-number="1.16">
<h2 data-number="1.16" class="anchored" data-anchor-id="forward-pricing-example-3"><span class="header-section-number">1.16</span> Forward Pricing (Example 3)</h2>
<p>A stock is expected to pay a dividend of $1 per share in two months and in five months. The stock price is $50, and the risk-free rate is 8% per annum (continuous compounding). An investor has just taken a short position in a six‐month forward contract on the stock.</p>
<ol type="a">
<li><p>What are the forward price and the initial value of the forward contract?</p></li>
<li><p>Three months later, with the stock price $48 and the risk-free rate still 8%, what are the forward price and the value of the short forward position?</p></li>
</ol>
<!-- ...solution removed... -->
</section>
<section id="forward-pricing-example-4" class="level2" data-number="1.17">
<h2 data-number="1.17" class="anchored" data-anchor-id="forward-pricing-example-4"><span class="header-section-number">1.17</span> Forward Pricing (Example 4)</h2>
<p>A trader owns a commodity with no income and no storage costs, with an ask price of $1250 and a bid price of $1249 per ounce. The borrowing rate is 6% (ask) and the investment rate is 5.5% (bid) per annum. For what range of one-year forward prices does no arbitrage occur?</p>
<!-- ...solution removed... -->
</section>
<section id="forward-pricing-example-5" class="level2" data-number="1.18">
<h2 data-number="1.18" class="anchored" data-anchor-id="forward-pricing-example-5"><span class="header-section-number">1.18</span> Forward Pricing (Example 5)</h2>
<p>A company enters a forward contract with a bank to sell a foreign currency for a price K₁ at time T₁. At T₁, the spot rate S₁ exceeds K₁. The company asks to roll the contract forward to time T₂ with a new delivery price K₂. How should K₂ be calculated?</p>
<!-- ...solution removed... -->
</section>
</section>
<section id="programming-exercises-optional" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Programming Exercises (Optional)</h1>
<section id="problem-calculating-forward-prices-with-dividends-using-aapl." class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="problem-calculating-forward-prices-with-dividends-using-aapl."><span class="header-section-number">2.1</span> Problem: Calculating Forward Prices with Dividends using AAPL.</h2>
<p>Using the ticker symbol “AAPL” (Apple Inc.), retrieve the closing price of Apple stock from the first business day of 2025. Find when and how much dividends Apple has paid in 2024. Assume Apple will pay the same stream of dividendin 2025. Assume that the risk-free rate is 5% per annum (continuously compounded).</p>
<p>Write R code to:</p>
<ol type="1">
<li>Calculate the present value of the estimated dividends.</li>
<li>Calculate the forward price for a 1-year forward contract on Apple stock.</li>
</ol>
<p><strong>Problem: Minimum Variance Hedge Ratio (Using Real Futures Data)</strong></p>
<p>Using the ticker symbols “GLD” (SPDR Gold Trust ETF, a proxy for gold spot price) and “GC=F” (Gold Futures, front-month contract on COMEX), retrieve the closing price data for the first 12 months from January 1, 2024. Since monthly changes require data from T-1 to T, retrieve data from December 2023 to December 2024.</p>
<p>Write R code to:</p>
<ol type="1">
<li>Calculate monthly percentage changes in the spot price (GLD) and futures price (GC=F).</li>
<li>Compute the correlation between the monthly percentage changes of the spot price</li>
<li>Calculate the standard deviations of the monthly percentage changes of GLD (spot) and GC=F (futures).</li>
<li>Determine the minimum variance hedge ratio,</li>
</ol>
<!-- ...solution code removed... -->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>