<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Ji-Woong Chung">

<title>Practice Problem Set: Problems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="problem_interest_files/libs/clipboard/clipboard.min.js"></script>
<script src="problem_interest_files/libs/quarto-html/quarto.js"></script>
<script src="problem_interest_files/libs/quarto-html/popper.min.js"></script>
<script src="problem_interest_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="problem_interest_files/libs/quarto-html/anchor.min.js"></script>
<link href="problem_interest_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="problem_interest_files/libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="problem_interest_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="problem_interest_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="problem_interest_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practice Problem Set: Problems</h1>
<p class="subtitle lead">BUSS386 Futures and Options</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Ji-Woong Chung </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<ul>
<li>If you notice any typos or errors, please feel free to <a href="chung_jiwoong@gmail.com">email me</a>.</li>
<li>Many of the problems are sourced from Hull (2022).</li>
</ul>
<hr>
<section id="computational-exercises" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Computational Exercises</h1>
<hr>
<section id="value-at-risk" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="value-at-risk"><span class="header-section-number">1.1</span> Value at Risk</h2>
<p>Consider a position consisting of a $100,000 investment in asset A and a $100,000 investment in asset B. Assume that the daily volatilities of both assets are 1% and that the coefficient of correlation between their returns is 0.3. What is the 5-day 99% VaR for the portfolio? Assume that asset prices follow the normal distribution.</p>
<hr>
</section>
<section id="value-at-risk-1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="value-at-risk-1"><span class="header-section-number">1.2</span> Value at Risk</h2>
<p>A company has a position in bonds worth $6 million. The modified duration of the portfolio is 5.2 years. Assume that only parallel shifts in the yield curve can take place and that the standard deviation of the daily yield change (when yield is measured in percent) is 0.09. Use the duration model to estimate the 20-day 90% VaR for the portfolio. Explain carefully the weaknesses of this approach to calculating VaR.</p>
<hr>
</section>
<section id="value-at-risk-2" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="value-at-risk-2"><span class="header-section-number">1.3</span> Value at Risk</h2>
<p>Consider a position consisting of a $300,000 investment in gold and a $500,000 investment in silver. Suppose that the daily volatilities of these two assets are 1.8% and 1.2% respectively, and that the coefficient of correlation between their returns is 0.6. What is the 10-day 97.5% VaR for the portfolio? By how much does diversification reduce the VaR?</p>
<hr>
</section>
<section id="interest-rate-conversion" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="interest-rate-conversion"><span class="header-section-number">1.4</span> Interest Rate Conversion</h2>
<p>A bank quotes you an interest rate of 14% per annum with quarterly compounding. What is the equivalent rate with (a) continuous compounding and (b) annual compounding?</p>
<hr>
</section>
<section id="bond-pricing" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="bond-pricing"><span class="header-section-number">1.5</span> Bond Pricing</h2>
<p>The six-month and one-year zero rates are both 10% per annum. For a bond that has a life of 18 months and pays a coupon of 8% per annum (with semiannual payments and one having just been made), the yield is 10.4% per annum. What is the bondâ€™s price? What is the 18-month zero rate? All rates are quoted with semiannual compounding.</p>
<hr>
</section>
<section id="par-yield" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="par-yield"><span class="header-section-number">1.6</span> Par Yield</h2>
<p>Suppose that the 6-month, 12-month, 18-month, and 24-month zero rates are 5%, 6%, 6.5%, and 7% respectively. What is the two-year par yield?</p>
<hr>
</section>
<section id="forward-rates" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="forward-rates"><span class="header-section-number">1.7</span> Forward Rates</h2>
<p>Suppose that zero interest rates with continuous compounding are as follows:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Maturity (months)</th>
<th>Rate (% per annum)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>8.0</td>
</tr>
<tr class="even">
<td>6</td>
<td>8.2</td>
</tr>
<tr class="odd">
<td>9</td>
<td>8.4</td>
</tr>
<tr class="even">
<td>12</td>
<td>8.5</td>
</tr>
<tr class="odd">
<td>15</td>
<td>8.6</td>
</tr>
<tr class="even">
<td>18</td>
<td>8.7</td>
</tr>
</tbody>
</table>
<p>Calculate forward interest rates for the second, third, fourth, fifth, and sixth quarters.</p>
<hr>
</section>
<section id="forward-rate-agreements" class="level2" data-number="1.8">
<h2 data-number="1.8" class="anchored" data-anchor-id="forward-rate-agreements"><span class="header-section-number">1.8</span> Forward Rate Agreements</h2>
<p>A bank can borrow or lend at LIBOR. Suppose that the six-month rate is 5% and the nine-month rate is 6%. The rate that can be locked in for the period between six months and nine months using an FRA is 7%. What arbitrage opportunities are open to the bank? All rates are continuously compounded.</p>
<hr>
</section>
<section id="forward-rate-agreements-1" class="level2" data-number="1.9">
<h2 data-number="1.9" class="anchored" data-anchor-id="forward-rate-agreements-1"><span class="header-section-number">1.9</span> Forward Rate Agreements</h2>
<p>The 6-month, 12-month, 18-month, and 24-month zero rates are 4%, 4.5%, 4.75%, and 5% with semiannual compounding.</p>
<ol type="a">
<li>What are the rates with continuous compounding?<br>
</li>
<li>What is the forward rate for the six-month period beginning in 18 months?<br>
</li>
<li>What is the value of an FRA that promises to pay you 6% (compounded semiannually) on a principal of $1 million for the six-month period starting in 18 months?</li>
</ol>
<hr>
</section>
<section id="bond-prices-and-interest-rate" class="level2" data-number="1.10">
<h2 data-number="1.10" class="anchored" data-anchor-id="bond-prices-and-interest-rate"><span class="header-section-number">1.10</span> Bond Prices and Interest Rate</h2>
<p>The following table gives the prices of bonds</p>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 29%">
<col style="width: 25%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Bond Principal ($)</th>
<th>Time to Maturity (yrs)</th>
<th>Annual Coupon ($)*</th>
<th>Bond Price ($)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>100</td>
<td>0.5</td>
<td>0.0</td>
<td>98</td>
</tr>
<tr class="even">
<td>100</td>
<td>1.0</td>
<td>0.0</td>
<td>95</td>
</tr>
<tr class="odd">
<td>100</td>
<td>1.5</td>
<td>6.2</td>
<td>101</td>
</tr>
<tr class="even">
<td>100</td>
<td>2.0</td>
<td>8.0</td>
<td>104</td>
</tr>
</tbody>
</table>
<p>*Half the stated coupon is paid every six months</p>
<ol type="a">
<li>Calculate zero rates for maturities of 6 months, 12 months, 18 months, and 24 months.<br>
</li>
<li>What are the forward rates for the periods: 6 months to 12 months, 12 months to 18 months, 18 months to 24 months?<br>
</li>
<li>What are the 6-month, 12-month, 18-month, and 24-month par yields for bonds that provide semiannual coupon payments?<br>
</li>
<li>Estimate the price and yield of a two-year bond providing a semiannual coupon of 7% per annum.</li>
</ol>
<hr>
</section>
<section id="duration" class="level2" data-number="1.11">
<h2 data-number="1.11" class="anchored" data-anchor-id="duration"><span class="header-section-number">1.11</span> Duration</h2>
<p>What does duration tell you about the sensitivity of a bond portfolio to interest rates? What are the limitations of the duration measure?</p>
<hr>
</section>
<section id="duration-1" class="level2" data-number="1.12">
<h2 data-number="1.12" class="anchored" data-anchor-id="duration-1"><span class="header-section-number">1.12</span> Duration</h2>
<p>A five-year bond with a yield of 11% (continuously compounded) pays an 8% coupon at the end of each year.</p>
<ol type="a">
<li>What is the bondâ€™s price (face value of 100)?<br>
</li>
<li>What is the bondâ€™s duration?<br>
</li>
<li>Use the duration to calculate the effect on the bondâ€™s price of a 0.2% decrease in its yield.<br>
</li>
<li>Recalculate the bondâ€™s price on the basis of a 10.8% per annum yield and verify that the result is in agreement with your answer to (c).</li>
</ol>
<hr>
</section>
<section id="duration-of-portfolios" class="level2" data-number="1.13">
<h2 data-number="1.13" class="anchored" data-anchor-id="duration-of-portfolios"><span class="header-section-number">1.13</span> Duration of Portfolios</h2>
<p>Portfolio A consists of a one-year zero-coupon bond with a face value of $2,000 and a 10-year zero-coupon bond with a face value of $6,000. Portfolio B consists of a 5.95-year zero-coupon bond with a face value of $5,000. The current yield on all bonds is 10% per annum.</p>
<ol type="a">
<li>Show that both portfolios have the same duration.<br>
</li>
<li>Show that the percentage changes in the values of the two portfolios for a 0.1% per annum increase in yields are the same.<br>
</li>
<li>What are the percentage changes in the values of the two portfolios for a 5% per annum increase in yields?</li>
</ol>
<hr>
</section>
</section>
<section id="programming-exercises-optional" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Programming Exercises (Optional)</h1>
<hr>
<section id="zero-coupon-bond-valuation-in-r" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="zero-coupon-bond-valuation-in-r"><span class="header-section-number">2.1</span> Zero-Coupon Bond Valuation in R</h2>
<p>You are given the following continuously compounded zero rates for maturities 1 through 5 years:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Maturity (Years)</th>
<th>Zero Rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2.0</td>
</tr>
<tr class="even">
<td>2</td>
<td>2.3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>2.6</td>
</tr>
<tr class="even">
<td>4</td>
<td>2.8</td>
</tr>
<tr class="odd">
<td>5</td>
<td>2.9</td>
</tr>
</tbody>
</table>
<p>Calculate the prices of zero-coupon bonds with face value $100 maturing in 1, 2, 3, 4, and 5 years using R.</p>
<hr>
</section>
<section id="spot-rate-curve-interpolation-in-r" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="spot-rate-curve-interpolation-in-r"><span class="header-section-number">2.2</span> Spot Rate Curve Interpolation in R</h2>
<p>You have spot rates at only a few maturities. Interpolate linearly using R to find the spot rate for a maturity you donâ€™t directly observe. Specifically, assume you have spot rates of 2.0% at 1 year and 2.3% at 2 years. Estimate the spot rate at 1.5 years using linear interpolation.</p>
<hr>
</section>
<section id="yield-to-maturity-ytm-calculation-in-r" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="yield-to-maturity-ytm-calculation-in-r"><span class="header-section-number">2.3</span> Yield to Maturity (YTM) Calculation in R</h2>
<p>Consider a bond with a face value of $100, a coupon rate of 5% (paid annually), and a maturity of 3 years. It is currently trading at $98. Use R to calculate the approximate yield to maturity (YTM).</p>
<hr>
</section>
<section id="duration-calculation-in-r" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="duration-calculation-in-r"><span class="header-section-number">2.4</span> Duration Calculation in R</h2>
<p>Consider a bond with a face value of $100, a coupon rate of 6% (paid annually), a YTM of 7%, and a maturity of 4 years. Calculate the Macaulay duration using R.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>