<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Prof.&nbsp;Ji-Woong Chung">

<title>Introduction to Swaps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="problem_swap_files/libs/clipboard/clipboard.min.js"></script>
<script src="problem_swap_files/libs/quarto-html/quarto.js"></script>
<script src="problem_swap_files/libs/quarto-html/popper.min.js"></script>
<script src="problem_swap_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="problem_swap_files/libs/quarto-html/anchor.min.js"></script>
<link href="problem_swap_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="problem_swap_files/libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="problem_swap_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="problem_swap_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="problem_swap_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction to Swaps</h1>
<p class="subtitle lead">BUSS386 Futures and Options</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Prof.&nbsp;Ji-Woong Chung </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="day-counting" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="day-counting"><span class="header-section-number">1</span> Day counting</h2>
<p>A U.S. Treasury bond pays a 7% coupon on January 7 and July 7. How much interest accrues per $100 of principal to the bond holder between July 7, 2014 and August 8, 2014? How would your answer be different if it were a corporate bond?</p>
</section>
<section id="cash-pricequoted-price" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="cash-pricequoted-price"><span class="header-section-number">2</span> Cash price/Quoted price</h2>
<p>It is January 9, 2015. The price of a Treasury bond with a 12% coupon that matures on October 12, 2030, is quoted as 102-07. What is the cash price?</p>
</section>
<section id="cheapest-to-deliver" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="cheapest-to-deliver"><span class="header-section-number">3</span> Cheapest to deliver</h2>
<p>Suppose that the Treasury bond futures price is 101-12. Which of the following four bonds is cheapest to deliver?</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Bond</th>
<th style="text-align: left;">Price</th>
<th style="text-align: left;">Conversion Factor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">125-05</td>
<td style="text-align: left;">1.2131</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">142-15</td>
<td style="text-align: left;">1.3792</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">115-31</td>
<td style="text-align: left;">1.1149</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">144-02</td>
<td style="text-align: left;">1.4026</td>
</tr>
</tbody>
</table>
</section>
<section id="bond-futures-price" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="bond-futures-price"><span class="header-section-number">4</span> Bond futures price</h2>
<p>It is July 30, 2015. The cheapest-to-deliver bond in a September 2015 Treasury bond futures contract is a 13% coupon bond, and delivery is expected to be made on September 30, 2015. Coupon payments on the bond are made on February 4 and August 4 each year. The term structure is flat, and the rate of interest with semiannual compounding is 12% per annum. The conversion factor for the bond is 1.5. The current quoted bond price is $110. Calculate the quoted futures price for the contract.</p>
</section>
<section id="eurodollar-futures" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="eurodollar-futures"><span class="header-section-number">5</span> Eurodollar futures</h2>
<p>A Eurodollar futures price changes from 96.76 to 96.82. What is the gain or loss to an investor who is long two contracts?</p>
</section>
<section id="eurodollar-futures-1" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="eurodollar-futures-1"><span class="header-section-number">6</span> Eurodollar futures</h2>
<p>Suppose that the nine-month LIBOR interest rate is 8% per annum and the six-month LIBOR interest rate is 7.5% per annum (both with actual/365 and continuous compounding). Estimate the three-month Eurodollar futures price quote for a contract maturing in six months.</p>
</section>
<section id="duration-and-convexity" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="duration-and-convexity"><span class="header-section-number">7</span> Duration and Convexity</h2>
<p><em>Throughout, use duration and convexity based on discretely compounded yield (e.g.&nbsp;semi-annual)</em></p>
<p>Assume that the Treasury yield curve is flat at 3% on an annual basis.</p>
<ol type="a">
<li><p>Calculate the modified duration and the convexity of a 1-year zero coupon Treasury bond.</p></li>
<li><p>Calculate the modified duration and the convexity of a 5-year Treasury bond with a coupon rate of 4%. Assume that the coupon is paid annually.</p></li>
<li><p>Suppose that you have a portfolio consisting of $100,000 invested in the 1-year bond in (a) and $250,000 invested in the 5-year bonds in (b). Using the approximation formula for price changes based on both duration and convexity, what will happen to the value of your portfolio if interest rates fall by 50 basis points (0.0050)?</p></li>
<li><p>Calculate the dollar duration of a 10-year fixed-for-floating interest rate swap with annual payments, a fixed rate of 3.25% on an annual basis, and a floating payment based on the 1-year swap yield that resets annually. Assume that the swap is currently priced at par, meaning that a fixed rate that sets the present value of all future floating cash flows equal to the present value of all future fixed cash flows. Also, it has a notional principal of $1 million, and the swap yield curve is flat at 3.25% on an annual basis. Report the result from the perspective of the floating rate payor.</p></li>
</ol>
</section>
<section id="hedging-interest-rate-risk" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="hedging-interest-rate-risk"><span class="header-section-number">8</span> Hedging Interest Rate Risk</h2>
<p>On August 1 a portfolio manager has a bond portfolio worth $10 million. The duration of the portfolio in October will be 7.1 years. The December Treasury bond futures price is currently 91-12 and the cheapest-to-deliver bond will have a duration of 8.8 years at maturity. How should the portfolio manager immunize the portfolio against changes in interest rates over the next two months? How can the portfolio manager change the duration of the portfolio to 3.0 years?</p>
</section>
<section id="hedging-interest-rate-risk-1" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="hedging-interest-rate-risk-1"><span class="header-section-number">9</span> Hedging Interest Rate Risk</h2>
<p>It is January 30. You are managing a bond portfolio worth $6 million. The duration of the portfolio in six months will be 8.2 years. The September Treasury bond futures price is currently 108-15, and the cheapest-to-deliver bond will have a duration of 7.6 years in September. How should you hedge against changes in interest rates over the next six months?</p>
</section>
<section id="hedging-interest-rate-risk-2" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="hedging-interest-rate-risk-2"><span class="header-section-number">10</span> Hedging Interest Rate Risk</h2>
<p>As the manager of a bond market mutual fund that holds a mix of corporate and Treasury bonds, you are concerned that the central bank will soon start to raise interest rates, causing the fundâ€™s value to fall and investors to redeem their holdings. The fund has $2.5 billion of assets under management, and a modified duration of 2.9 years.</p>
<ol type="a">
<li><p>If the fund rules permit the use of swaps and you want to hedge against rates rising, would you enter into the interest rate swap described in 1(d) as the fixed or floating rate payor?</p></li>
<li><p>If you set up a delta hedge (duration-neutral) using swap in 1(d), what is the notional principal of the position you would take?</p></li>
<li><p>If all interest rates rise by 25 basis points overnight, calculate the estimated gain or loss on the swap used to delta hedge, using the approximation formula for a price changes based only on duration. Also calculate the approximate change in the value of the mutual fundâ€™s assets. Use + and - to indicate gains and loss, respectively.</p></li>
<li><p>If all interest rates rise by 25 basis points overnight, calculate the gain or loss on the swap used to hedge using both duration and convexity.</p></li>
<li><p>Based on (c) and (d), the swap is adding negative convexity to the fundsâ€™ overall interest rate exposure. (True or False)</p></li>
<li><p>Which of the following are reasons that this hedge may be imperfect? Select all that apply.</p></li>
</ol>
<ol type="1">
<li><p>The corporate bonds held by the mutual funds have default risk.</p></li>
<li><p>Intrest rate changes may be different at different points on the yield curve.</p></li>
<li><p>The convexity of the mutual fund holdings may be different than the convexity of the swap.</p></li>
<li><p>Interest rate move but the hedge is not adjusted.</p></li>
<li><p>There is a large jump in interest rates.</p></li>
</ol>
<section id="interest-rate-swap" class="level3" data-number="10.1">
<h3 data-number="10.1" class="anchored" data-anchor-id="interest-rate-swap"><span class="header-section-number">10.1</span> Interest Rate Swap</h3>
<p>Companies A and B have been offered the following rates per annum on a $20 million five-year loan:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Company</th>
<th style="text-align: left;">Fixed Rate</th>
<th style="text-align: left;">Floating Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Company A</td>
<td style="text-align: left;">5.0%</td>
<td style="text-align: left;">LIBOR+0.1%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Company B</td>
<td style="text-align: left;">6.4%</td>
<td style="text-align: left;">LIBOR+0.6%</td>
</tr>
</tbody>
</table>
<p>Company A requires a floating-rate loan; company B requires a fixed-rate loan. Design a swap that will net a bank, acting as intermediary, 0.1% per annum and that will appear equally attractive to both companies.</p>
</section>
<section id="currency-swap" class="level3" data-number="10.2">
<h3 data-number="10.2" class="anchored" data-anchor-id="currency-swap"><span class="header-section-number">10.2</span> Currency Swap</h3>
<p>Company X wishes to borrow U.S. dollars at a fixed rate of interest. Company Y wishes to borrow Japanese yen at a fixed rate of interest. The amounts required by the two companies are roughly the same at the current exchange rate. The companies have been quoted the following interest rates, which have been adjusted for the impact of taxes:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Company</th>
<th style="text-align: left;">Yen</th>
<th style="text-align: left;">Dollars</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Company X</td>
<td style="text-align: left;">5.0%</td>
<td style="text-align: left;">9.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Company Y</td>
<td style="text-align: left;">6.5%</td>
<td style="text-align: left;">10.0%</td>
</tr>
</tbody>
</table>
<p>Design a swap that will net a bank, acting as intermediary, 50 basis points per annum. Make the swap equally attractive to the two companies and ensure that all foreign exchange risk is assumed by the bank.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>